\newpage
a
\newpage
\section{形式化するにあたって}
今回，Coq + SSReflect を用いて三角形三色問題の証明の形式化を完成させることができた．ここでは，形式化を完成させるにあたって経験したことや得られた知見について述べる．

$1$つ目として挙げるのは，形式化をする際には，形式化する方針をしっかりと考え，計画を立ててから実装するべきだということである．
なぜなら，形式化の方針によっては Coq で実装するコードの行数が非常に変化するからである．
実際，彩色関数ではなく彩色を意味する述語を用いた実装で形式化したが，そのコードは約 $1200$ 行であった．
一方，形式化の方針を変え，彩色関数を用いて形式化した三角形三色問題のコードは約 $900$ 行となり約 $300$ 行も減らすことができた．
また，述語を用いた実装では，左から $x$ 番目，上から $y$ 番目のマスに塗られている色は $c$ であることを述語 $Cpos(x,y,c)$ とし，この述語が表す内容を公理を用いて定めることで命題や主張を表していた．
そのため，述語の定義だけでなく，その述語が満たしてもらいたい性質等を公理や補題という形で準備する必要があったためコードの行数が増えてしまったのだと考えられる．
さらに，述語ではなく関数を用いて形式化すると，実装するコードの行数を大幅に削減できるだけでなく，公理を用意する必要がなくなるというメリットもあることもわかった．
これは公理でマスに塗られる色は$1$色のみ存在することを保証していたが，関数に書き直すことで一意性を常に満たすからである．

$2$つ目としては，SSReflect を用いる際にはできる限り bool 型で実装することである．SSReflect には命題や主張をブール型と見なすことで証明を支援する機能が備わっている．そのため，SSReflect を用いる際には Prop 型ではなく bool 型として実装することで，様々な SSReflect の恩恵をうけることができる．例えば，bool 型で書かれた命題や主張はタクティック rewrite を用いることで真理値を計算したり，変形することで容易に証明することができる．
また，関数を定義する際に if 文を用いることがあるが，if 文の条件部分は bool 型を要求する．こういった側面からも Prop 型ではなく bool 型で実装した方が良いと考えられる．

一方で，$\forall$，$\exists$ が入った論理式は bool 型になおすことが困難であるため，今回の形式化を完成させる際に用いた $\Fmix$ は bool 型になおすことができなかった．したがって，$\WCTF$ は $\Fmix$ を含むので bool 型になおすことができず，形式化するにあたって用いたすべての主張や命題を bool 型を書き直すことができなかった．もし，この問題が解決することができたときには，更に形式化を完成させるためのコードを減らすことができるのではないかと考えられる．

\newpage
\section{形式化するにあたって(比較用)}

今回の形式化を完成させるにあたって経験したことや得られた知見について述べる．

第一に，形式化をする際には問題の性質を吟味し，問題に合った適切な方法を選択して実装するべきである．
これは Coq で実装するコードの行数が形式化の方法によって大きく左右されるからである．
実際，「$y$行目$x$番目のマスの色は$c$だ」を意味する彩色述語$Cpos(x,y,c)$ を用いた初期の実装では約 $1200$ 行のコードであったが，形式化の方針を見直して彩色関数に基づいた現在の実装では約 $900$ 行となり，約 $300$ 行削減に成功した．
彩色述語を用いる方針では，「各マスには必ず色が塗られる」や「1つのマスに2色以上は塗られない」などの彩色に関する暗黙の仮定を$Cpos$が満たすべき性質(公理)として記述する必要があり，その性質の前提の下で各種の補題を示す必要があったことがコード行数の増加の原因となっていた．
さらに，彩色関数を用いた形式化では公理が不要になり，証明の見通しが良くなった利点もあった．これは彩色に関する暗黙の仮定は関数であれば自動的に満たされるからで，不要な議論の減少によりスムーズな証明を得ることができた．

第二に，SSReflect を用いる際にはできる限り Prop型でなく bool 型で実装し，SSReflect の恩恵を最大限利用するべきである．SSReflect には命題をブール型と見なすことで命題の同値性をブール型の項の等式に置き換える機能を提供する．これにより手間のかかる同値変形を証明する代わりに rewrite タクティックによる等式変形をしながら素早く証明を進めることができる．
また，bool 型を積極的に用いる方針は if 文を用いた関数定義とも相性がよい．関数の値を求める際に if 文の条件判定のためにいちいち Prop型からbool型の変換するような手間も省くことができる．こういった側面からも Prop 型ではなく bool 型で実装した方が良いと考えられる．
一方で，$\forall$，$\exists$ が入った論理式は bool 型になおすことが困難であるため，今回の形式化を完成させる際に用いた $\Fmix$ は bool 型になおすことができなかった．したがって，$\WCTF$ は $\Fmix$ を含むので bool 型になおすことができず，形式化するにあたって用いたすべての主張や命題を bool 型を書き直すことができなかった．もし，この問題が解決することができたときには，更に形式化を完成させるためのコードを減らすことができるのではないかと考えられる．


\newpage
%% 目標：これで得られた知見をまとめる (読者との情報共有)
%% - 形式化の最初の方針が肝心．上手い選択をすると証明の行数が大幅に削減できる
%% - 述語はやめる．関数で書けるならそっちの方がよい．
%% --- 自然と rewrite を使うことになるので ssreflect の利点を生かすことになる．
%% - できることなら Prop でなく bool で統一した方が ssreflect の利点が生きる
%% --- 関数定義をする際に if 文を用いると条件は bool 型を要求されるため，
%% --- 条件部分の述語は Prop 型でなく bool 型で最初から定義するとよい
%% -- forall や exists が入った論理式は無理そう
%% -- この理由により F_mix は bool にはできなかった
%% -- WellColoredTriangleF は F_mix を含むので bool にできなかった
%% - 紙に証明を書いてから実装するべし
%% -- 証明の設計は大事．全体の方針が見えるように上手く補題を立てるべし
