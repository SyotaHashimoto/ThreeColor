% 三角形三色問題の概要（数学）
% 調和彩色三角形 (well-colored triangle)
% 彩色三角形が調和している
% 彩色三角形が調和性をみたす
\section{三角形三色問題の概要}
三角形三色問題について述べる前に調和性と調和彩色三角形の定義について先に述べる．
以下，$3$色のどれかの色が塗られた同じ大きさの正六角形のマスが平面上に逆三角形の形に敷き詰められている状況を考える (図~\ref{fig:nine_steps}参照)
\footnote{
  ここでは青，赤，黄の三色を用いることにし，各マスにはそれぞれ B, R, Y を記入している．
}．

\begin{dfn}[調和性] \label{dfn:wc}\rm
  (隣接しているとは限らない) $3$つのマスに塗られている色がすべて同じか相異なるとき，
  この$3$マスは{\em 調和性}を満たすという．
\end{dfn}

\begin{exm}
  図$\ref{wellcoloed}$のような$3$マスの組は調和性を満たしているが，
  図$\ref{notwellcoloed}$のような$3$マスの組は調和性を満たしていない．
  \begin{figure}[h]
    \centering
    \input{wellcolored}
    \caption{調和性を満たす$3$色の組}
    \label{wellcoloed}
  \end{figure}
  \begin{figure}[h]
    \centering
    \input{notwellcolored}
    \caption{調和性を満たさない$3$色の組}
    \label{notwellcoloed}
  \end{figure}
\end{exm}

\begin{dfn}[彩色三角形] \label{dfn:three_tri}\rm
  隣接した全ての$3$マスが調和性を満たすように色が塗られた逆三角形を
  {\em 彩色三角形}という．
\end{dfn}

\begin{dfn}[調和彩色三角形] \label{dfn:wc_tri}\rm
  $3$つの端点のマスに塗られている色が調和性を満たしている彩色三角形を{\em 調和彩色三角形} (well-colored triangle) という．
\end{dfn}

次に三角形三色問題について述べる．
  $n(>0)$段の彩色三角形がある．
  図\ref{fig:nine_steps}は$n=9$のときの彩色三角形である．
  このとき，最下段のマスの色は赤であり，最上段の両端のマスは黄，青であるから
  最上段の両端のマスの色と最下段のマスの色について調和性を満たしている (つまり，調和彩色三角形である) ことが分かる．

\begin{figure}[h]
    \centering
    \input{nine_steps}
    \caption{彩色三角形（$n=9$のとき）}
    \label{fig:nine_steps}
\end{figure}

$n=9$の場合は最上段の塗り方が図\ref{fig:nine_steps}の塗り方でなくとも逆三角形の$3$つの頂点のマスは調和性を満たすことが観察できる．
このことから次のような仮説が考えられる．
\begin{itemize}
  \item[(仮説)]
  最上段をどのように塗っても最上段の両端のマスの色と最下段のマスの色は調和性を満たす．
\end{itemize}

数学セミナー誌で出題された三角形三色問題は次の$2$つの問題のことである~\cite{Nishiyama2}．
\begin{enumerate}
\item \label{que:1}
  $n=9$のとき仮説が成立することを証明せよ．
\item \label{que:2}
  $n=9$以外に仮説が成立する段数が存在するか調べ，存在するならば$n$の一般式を求めよ．
\end{enumerate}

この問題については既に解答が得られており，
一般に$n=3^k$段の逆三角形において仮説が成立することを示す次の定理\ref{thm:tri_iff}が示されている．

\begin{thm} \label{thm:tri_iff}
  $n(>0)$段の逆三角形に配置されたマス対して，
  最上段のマスを$3$色で任意に塗ったとき
  \[
  (\exists k\in\N.n=3^k) \Leftrightarrow \text{$n$段の逆三角形は常に調和彩色三角形}.
  \]
\end{thm}

本節ではこの定理の証明を Coq で実装するにあたり，証明の概要について述べる．

% 2.1 n=3^k => 調和三角形
\subsection{十分条件}
定理\ref{thm:tri_iff}を証明するにあたって，十分条件と必要条件に分けて話を進める．
ここでは定理\ref{thm:tri_iff}の十分条件である定理\ref{thm:tri_suf}の証明の概要について述べる．
\begin{thm}[十分条件] \label{thm:tri_suf}
  $n$段の逆三角形に配置されたマス対して，
  \[
  (\exists k\in\N.n=3^k) \Imp \text{$n$段の逆三角形は常に調和彩色三角形}.
  \]
\end{thm}
定理\ref{thm:tri_suf}を証明するためには論理同値である次の命題を証明すればよい．
\[
\forall k\in\N.(n=3^k \Imp \text{$n$段の逆三角形は常に調和彩色三角形}).
\]
これは$k$に関する数学的帰納法を用いて証明する．
\begin{itemize}
\item
  $k=0$のときは$n=1$となり明らかに成立する．
\item
  $k$ のとき成立すると仮定する．
  すなわち，$3^{k}$段の逆三角形ならば常に調和彩色三角形であると仮定する．
  
  ここからは図\ref{fig:ind_steps}を用いて証明を進める．
  以下，左から$x$番目，上から$y$段目のマスを$\V{x}{y}$と書くことにし，
  このマスに塗られている色を$\C{x}{y}$とする．  
\begin{figure}[h]
    \centering
    \input{ind_steps}
    \caption{彩色三角形（$n=3^{k+1}$のとき）}
    \label{fig:ind_steps}
\end{figure}
ここで，図\ref{fig:ind_steps}の中にあるいくつかの$3^k$段の彩色三角形に注目する．
説明を簡単にするために，頂点$\V{x_0}{y_0}$，$\V{x_1}{y_1}$，$\V{x_2}{y_2}$の彩色三角形を
その$3$つの頂点のマスの色を組にして$(\C{x_0}{y_0},\C{x_1}{y_1},\C{x_2}{y_2})$と表すことにする．
上から$0$段目から$3^{k}$段目の間では次の$3$つの彩色三角形
\begin{center}
$\left(\C{0}{0},\C{3^{k}}{0},\C{0}{3^{k}}\right)$,
\quad
$\left(\C{3^{k}}{0},\C{2\cdot3^{k}}{0},\C{3^{k}}{3^{k}}\right)$,
\\
$\left(\C{2\cdot3^{k}}{0},\C{3^{k+1}}{0},\C{2\cdot3^{k}}{3^{k}}\right)$
\end{center}
に注目すると帰納法の仮定よりこれらは調和彩色三角形である．
よって最上段の$4$つのマスの色$\C{0}{0}$，$\C{3^k}{0}$，$\C{2\cdot 3^k}{0}$，$\C{3^{k+1}}{0}$から
$3^k$段目のマスの色$\C{0}{3^k}$，$\C{3^k}{3^k}$，$\C{2\cdot 3^k}{3^k}$を計算して求めることができる．
また，上から$3^{k}$段目から$2\cdot3^{k}$段目の間にある$2$個の彩色三角形
\[
\left(\C{0}{3^{k}},\C{3^{k}}{3^{k}},\C{0}{2\cdot3^{k}}\right),
\quad
\left(\C{3^{k}}{3^{k}},\C{2\cdot3^{k}}{3^{k}},\C{3^{k}}{2\cdot3^{k}}\right)
\]
も調和彩色三角形 (帰納法の仮定) である．よって$\C{0}{3^k}$，$\C{3^k}{3^k}$，$\C{2\cdot 3^k}{3^k}$から
$2\cdot 3^k$段のマスの色$\C{0}{2\cdot 3^k}$と$\C{3^k}{2\cdot 3^k}$を計算して求めることができる．
同じく帰納法の仮定より，上から$2\cdot3^{k}$段目から$3^{k+1}$段目の間にある彩色三角形
\[
\left(\C{0}{2\cdot3^{k}},\C{3^{k}}{2\cdot3^{k}},\C{0}{3^{k+1}}\right)
\]
も調和彩色三角形である．よって$\C{0}{2\cdot 3^k}$と$\C{3^k}{2\cdot 3^k}$から最下段のマスの色$\C{0}{3^{k+1}}$を得ることができる．
さらに，簡単な計算\footnote{81通りの場合分けをする}により$\C{0}{0}$および$\C{3^{k+1}}{0}$と最下段の色$\C{0}{3^{k+1}}$は調和性を満たすことがいえるので
$(\C{0}{0},\C{3^{k+1}}{0},\C{0}{3^{k+1}})$は調和彩色三角形である．
%これらの$6$個の$3^k$段の彩色三角形はすべて帰納法の仮定より常に調和彩色三角形である．
%よって，調和彩色三角形の定義より最上段のマスの$4$色$c^0_0$，$c^{3^{k}}_0$，$c^{2\cdot3^{k}}_0$，$c^{3^{k+1}}_0$から最下段のマスの$c^0_{3^{k+1}}$の色が得られる．
%% ---------- 未修正 ----------
%最後に，$4$色$c^0_0$，$c^{3^{k}}_0$，$c^{2\cdot3^{k}}_0$，$c^{3^{k+1}}_0$に対して，
%から得られた色は$c^0_0, c^{3^{k+1}}_0$が規則に従った色と等しくなることを
%利用すると，
%% ------------------------------
%最上段の両端のマスに塗られている$2$色$\C{0}{0}$，$\C{3^{k+1}}{0}$と最下段の色$\C{0}{3^{k+1}}$は調和性を満たす．
以上より，$3^{k+1}$段の逆三角形は常に調和彩色三角形である．
\end{itemize}
% 2.2 調和 (well-colored) => n=3^k
\subsection{必要条件}
次は定理\ref{thm:tri_iff}の必要条件である定理\ref{thm:tri_nec}の証明の概要について述べる．
\begin{thm}[必要条件] \label{thm:tri_nec}
  $n(>0)$段の逆三角形に配置されたマス対して，
  \[
  \text{$n$段の逆三角形は常に調和彩色三角形} \Imp (\exists k.n=3^k).
  \]
\end{thm}
定理\ref{thm:tri_nec}の証明では対偶法を用いた後に，$n$に関する場合分けをして証明する．
定理\ref{thm:tri_nec}の対偶は以下の通り．

$\lnot$ $(\exists$ $k\in\N.n=3^k)$ $\Imp$ $\lnot($ $n$段の逆三角形は常に調和彩色三角形$)$．

したがって，$\lnot(\exists k\in\N.n=3^k)$を仮定したとき，次の各場合について調和彩色三角形にならない最上段のマスの塗り方を挙げればよい．
場合分けの仕方は次の$3$つである．
\begin{enumerate}
\item \label{case:even}
  $n$が偶数
\item \label{case:shortodd}
  $n$が奇数 かつ $3^{k} < n \leq 2 \cdot 3^{k}$
\item \label{case:longodd}
  $n$が奇数 かつ $2 \cdot 3^{k} + 1 \leq n < 3^{k+1}$
\end{enumerate}
各場合について調和彩色三角形にならないような最上段のマスの塗り方は次の通り．
\begin{itemize}
  \item
    \ref{case:even}.のときは最上段のマスを黄，青の順で交互に塗る（図~\ref{fig:even_steps}参照）．
    すると，$n$が偶数であるため最上段のマス数は奇数個となるから，
    最上段の両端のマスは黄色になり，
    第$1$段目のマスは規則よりすべて赤色で塗られる．
    さらに，もう一方の規則より最下段のマスまですべて赤で塗られている．
    したがって，$n$が偶数であるから最上段の両端のマスは黄であり，最下段のマスの色が赤であるから調和性を満たさないので調和彩色三角形でない．
    \begin{figure}[h]
      \centering
      \input{even_steps}
      \caption{$n$が偶数}
      \label{fig:even_steps}
    \end{figure}
  \item
    \ref{case:shortodd}.のときは最上段のマスを外側の両端のマスから内側の方に向かって黄，青の順で$2$色を用いて対称的に交互に塗る（図~\ref{fig:shortodd_steps}参照）．
    %% ---------- 未修正 ----------
    すると，補題\ref{lem:tri_suf}より$3^k$段の逆三角形は調和彩色三角形なので，最上段から$3^k$段下のマスは黄，青の順で交互に塗られている．
    これは\ref{case:even}.の場合に帰着できるので最下段のマスの色は赤である．
    したがって，最上段の両端のマスの色は黄であり，最下段のマスの色が赤であるから調和性を満たさないので調和彩色三角形でない．
    %% ------------------------------
    \begin{figure}[h]
      \centering
      \input{shortodd_steps}
      \caption{$n$が奇数 かつ $3^{k} < n \leq 2 \cdot 3^{k}$}
      \label{fig:shortodd_steps}
    \end{figure}
  \item
    \ref{case:longodd}.のときは最上段のマスを両端のマスからそれぞれ$3^k$マス内側の方に向かって黄，その他の内側のマスを青を用いて対称的に塗る（図~\ref{fig:longodd_steps}参照）．
    このとき，黄で塗られている内側のマスは$n-2\cdot3^k+1$マスである．
    %% ---------- 未修正 ----------
    すると，補題\ref{lem:tri_suf}より$3^k$段の逆三角形は調和彩色三角形なので，最上段から$3^k$段において外側から$n-2\cdot3^k+1$マスはすべて赤で塗られている．
    同様にして，$2\cdot3^k$段下のマスの色はすべて赤で塗られている．
    したがって，最上段の両端のマスの色は黄であり，最下段のマスの色が赤であるから調和性を満たさないので調和彩色三角形でない．
    %% ------------------------------
    \begin{figure}[h]
      \centering
      \input{longodd_steps}
      \caption{$n$が奇数 かつ $2 \cdot 3^{k} + 1 \leq n < 3^{k+1}$}
      \label{fig:longodd_steps}
    \end{figure}
\end{itemize}

